import{_ as t,c as a,a2 as i,j as s,a as n,o as e}from"./chunks/framework.DPuwY6B9.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"resource/duktape/guide/custom_json_formats.md","filePath":"resource/duktape/guide/custom_json_formats.md","lastUpdated":1732350347000}'),d={name:"resource/duktape/guide/custom_json_formats.md"};function u(h,l,r,p,k,o){return e(),a("div",null,l[0]||(l[0]=[i(`<h2 id="custom_json_formats" tabindex="-1">カスタムJSONフォーマット <a class="header-anchor" href="#custom_json_formats" aria-label="Permalink to &quot;カスタムJSONフォーマット {#custom_json_formats}&quot;">​</a></h2><h3 id="ecmascript-の-json-の欠点" tabindex="-1">ECMAScript の JSON の欠点 <a class="header-anchor" href="#ecmascript-の-json-の欠点" aria-label="Permalink to &quot;ECMAScript の JSON の欠点&quot;">​</a></h3><p>標準の JSON フォーマットは、ECMAScript で使用する場合、いくつかの欠点があります。</p><p>-未定義値や関数値はサポートされていません。 -NaN と無限大の値はサポートされていません。 -Duktapeのカスタム・タイプは、もちろんサポートされていません。 -BMP以上のコードポイントは、サロゲート・ペアとしてしか表現できない -U+10FFFF以上のコードポイントは、サロゲート・ペアとしても表現できません。 -出力が印刷可能なASCIIでないため、不便なことが多い</p><p>これらの制限は、ECMAScript仕様の一部であり、より甘い動作を明示的に禁止しています。Duktapeは、よりプログラマフレンドリーな2種類のカスタムJSONフォーマットを提供しています。JXとJCで、以下に説明します。</p><h3 id="カスタムjxフォーマット" tabindex="-1">カスタムJXフォーマット <a class="header-anchor" href="#カスタムjxフォーマット" aria-label="Permalink to &quot;カスタムJXフォーマット&quot;">​</a></h3><p>JXは、すべての値を非常に読みやすい方法でエンコードし、ほとんどすべての値を忠実にパースして返します（関数値は最も重要な例外です）。出力は純粋に印刷可能なASCIIで、U+FFFF以上のコードポイントはカスタムエスケープ形式でエンコードされ、オブジェクトキーの周りの引用符はほとんどの場合省略されます。JXはJSON互換ではありませんが、非常に読みやすいフォーマットで、デバッグやロギングなどに最も適しています。</p><p>JXは以下のように使用します。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { foo: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, bar: [ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] };</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Duktape.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, obj));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// prints out: {foo:NaN,bar:[1,undefined,3]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Duktape.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;{ foo: 123, bar: undefined, quux: NaN }&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dec.foo, dec.bar, dec.quux);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// prints out: 123 undefined NaN</span></span></code></pre></div><h3 id="カスタム-jc-フォーマット§。" tabindex="-1">カスタム JC フォーマット§。 <a class="header-anchor" href="#カスタム-jc-フォーマット§。" aria-label="Permalink to &quot;カスタム JC フォーマット§。&quot;">​</a></h3><p>JCは、すべての値を標準的なJSONにエンコードします。標準的なJSONでサポートされていない値は、アンダースコアで始まるマーカーキーを持つオブジェクトとしてエンコードされます（例： {&quot;_ptr&quot;: &quot;0xdeadbeef&quot;}）。このような値は、通常のオブジェクトとしてパースバックされます。しかし、多かれ少なかれ、手動でそれらを復活させることができます。U+FFFF以上のコードポイントは、&quot;U+nnnnn &quot;のフォーマットでプレーンな文字列データとしてエンコードされます(例: U+0010fedc)。</p><p>JCは以下のように使用します。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { foo: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, bar: [ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] };</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Duktape.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, obj));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// prints out: {&quot;foo&quot;:{&quot;_nan&quot;:true},&quot;bar&quot;:[1,{&quot;_undef&quot;:true},3]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Duktape.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;{ &quot;foo&quot;: 123, &quot;bar&quot;: {&quot;_undef&quot;:true}, &quot;quux&quot;: {&quot;_nan&quot;:true} }&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dec.foo, dec.bar, dec.quux);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// prints out: 123 [object Object] [object Object]</span></span></code></pre></div><p>JCデコーダは、現時点では、基本的に標準のJSONデコーダと同じです。すべてのJC出力は有効なJSONであり、カスタム構文は必要ありません。例で示したように、カスタム値（{&quot;_undef&quot;:true}など）は自動的には復活しません。それらは、代わりに普通のオブジェクトとしてパースバックされます。</p><h3 id="u-ffff以上のコードポイントと無効なutf-8データについて" tabindex="-1">U+FFFF以上のコードポイントと無効なUTF-8データについて <a class="header-anchor" href="#u-ffff以上のコードポイントと無効なutf-8データについて" aria-label="Permalink to &quot;U+FFFF以上のコードポイントと無効なUTF-8データについて&quot;">​</a></h3><p>すべての標準ECMAScript文字列は、内部的には有効なCESU-8データなので、U+FFFF以上のコードポイントに対する動作は、コンプライアンス上の問題を引き起こすことはありません。しかし、Duktapeの文字列は、拡張UTF-8コードポイントを含み、さらに無効なUTF-8データを含む可能性があります。</p><p>標準のECMAScript JSON APIを含むDuktape JSON実装は、無効なUTF-8データを処理するために置換文字を使用します。結果として得られる文字列は少し奇妙に見えるかもしれませんが、この動作はエラーを投げるよりも望ましいものです。</p><h3 id="jsonフォーマット例" tabindex="-1">JSONフォーマット例 <a class="header-anchor" href="#jsonフォーマット例" aria-label="Permalink to &quot;JSONフォーマット例&quot;">​</a></h3><p>以下の表は、各エンコーディングで異なる値がどのようにエンコードされるかをまとめたものです。</p>`,19),s("table",{tabindex:"0"},[s("thead",null,[s("tr",null,[s("th",null,"Value"),s("th",null,"Standard JSON"),s("th",null,"JX"),s("th",null,"JC"),s("th",null,"Notes")])]),s("tbody",null,[s("tr",null,[s("td",null,"undefined"),s("td",null,"n/a"),s("td",null,"undefined"),s("td",{"_undef:true":""}),s("td",null,"Standard JSON: encoded as null inside arrays, otherwise omitted")]),s("tr",null,[s("td",null,"null"),s("td",null,"null"),s("td",null,"null"),s("td",null,"null"),s("td",null,"standard JSON")]),s("tr",null,[s("td",null,"true"),s("td",null,"true"),s("td",null,"true"),s("td",null,"true"),s("td",null,"standard JSON")]),s("tr",null,[s("td",null,"false"),s("td",null,"false"),s("td",null,"false"),s("td",null,"false"),s("td",null,"standard JSON")]),s("tr",null,[s("td",null,"123.4"),s("td",null,"123.4"),s("td",null,"123.4"),s("td",null,"123.4"),s("td",null,"standard JSON")]),s("tr",null,[s("td",null,"+0"),s("td",null,"0"),s("td",null,"0"),s("td",null,"0"),s("td",null,"standard JSON")]),s("tr",null,[s("td",null,"-0"),s("td",null,"0"),s("td",null,"-0"),s("td",null,"-0"),s("td",null,"Standard JSON allows -0 but serializes negative zero as 0 (losing the sign unnecessarily)")]),s("tr",null,[s("td",null,"NaN"),s("td",null,"null"),s("td",null,"NaN"),s("td",{"_nan:true":""}),s("td",null,"Standard JSON: always encoded as null")]),s("tr",null,[s("td",null,"Infinity"),s("td",null,"null"),s("td",null,"Infinity"),s("td",{"_inf:true":""}),s("td",null,"Standard JSON: always encoded as null")]),s("tr",null,[s("td",null,"-Infinity"),s("td",null,"null"),s("td",null,"-Infinity"),s("td",{"_ninf:true":""}),s("td",null,"Standard JSON: always encoded as null")]),s("tr",null,[s("td",null,'"köhä"'),s("td",null,'"köhä"'),s("td",null,'"k\\xf6h\\xe4"'),s("td",null,'"k\\u00f6h\\u00e4"'),s("td")]),s("tr",null,[s("td",null,"U+00FC"),s("td",null,'"\\u00fc"'),s("td",null,'"\\xfc"'),s("td",null,'"\\u00fc"'),s("td")]),s("tr",null,[s("td",null,"U+ABCD"),s("td",null,'"\\uabcd"'),s("td",null,'"\\uabcd"'),s("td",null,'"\\uabcd"'),s("td")]),s("tr",null,[s("td",null,"U+1234ABCD"),s("td",null,'"U+1234abcd"'),s("td",null,'"\\U1234abcd"'),s("td",null,'"U+1234abcd"'),s("td",null,"Non-BMP characters are not standard ECMAScript, JX format borrowed from Python")]),s("tr",null,[s("td",null,"object"),s("td",{"my_key:123":""}),s("td",{"my_key:123":""}),s("td",{"my_key:123":""}),s("td",null,"ASCII keys matching identifer requirements encoded without quotes in JX")]),s("tr",null,[s("td",null,"array"),s("td",null,'["foo","bar"]'),s("td",null,'["foo","bar"]'),s("td",null,'["foo","bar"]'),s("td")]),s("tr",null,[s("td",null,"buffer"),s("td",null,"n/a"),s("td",null,"|deadbeef|"),s("td",{"_buf:deadbeef":""}),s("td")]),s("tr",null,[s("td",null,"pointer"),s("td",null,"n/a"),s("td",null,"(0xdeadbeef)"),s("td",{"_ptr:0xdeadbeef":""}),s("td")]),s("tr",null,[s("td"),s("td"),s("td",null,"(DEADBEEF)"),s("td",{"_ptr:DEADBEEF":""}),s("td",null,"Representation inside parentheses or quotes is platform specific")]),s("tr",null,[s("td",null,"NULL pointer"),s("td",null,"n/a"),s("td",null,"(null)"),s("td",{"_ptr:null":""}),s("td")]),s("tr",null,[s("td",null,"function"),s("td",null,"n/a"),s("td",{"_func:true":""}),s("td",{"_func:true":""}),s("td",null,"Standard JSON: encoded as null inside arrays, otherwise omitted")]),s("tr",null,[s("td",null,"lightfunc"),s("td",null,"n/a"),s("td",{"_func:true":""}),s("td",{"_func:true":""}),s("td",null,"Formats like ordinary functions")])])],-1),s("h3",{id:"制限事項",tabindex:"-1"},[n("制限事項 "),s("a",{class:"header-anchor",href:"#制限事項","aria-label":'Permalink to "制限事項"'},"​")],-1),s("p",null,"いくつかの制限事項があります。",-1),s("ul",null,[s("li",null,"列挙可能な自身のプロパティのみが、どのフォーマットでもシリアライズされます。"),s("li",null,'配列のプロパティ（エントリ以外）はシリアライズされません。これは、例えばロギングなどで [1,2,3, "type": "point"] のように有用でしょう。'),s("li",null,"配列のギャップは保存されず、未定義としてパースバックされます。"),s("li",null,"JCデータの解析時に、特殊な値を自動的に復活させることはありません。"),s("li",null,"正規のエンコーディングがない。これは、エンコード時にオブジェクトのキーをソートする簡単なオプションで簡単にアレンジできるだろう。")],-1),s("p",null,"(今後の課題については、内部ドキュメントを参照してください)。",-1)]))}const F=t(d,[["render",u]]);export{c as __pageData,F as default};
